Project "Auto-Slide": PowerPoint Automation Pipeline

1. Обзор проекта

"Project Auto-Slide" — это Python-пайплайн, предназначенный для полной автоматизации процесса создания презентаций .pptx из структурированных данных.

Основная решаемая задача:
Устранение ручного труда («мартышкин труд») по копированию-вставке текста (заголовков, номеров слайдов, заметок докладчика) и скриншотов из исходных материалов (JSON, Markdown) в PowerPoint. Проект изначально мотивирован задачей быстрой сборки видео-презентаций из заранее подготовленного контента.

2. Архитектура и Технологии

Пайплайн построен на принципе разделения данных, стиля и логики:

Стиль (Контракт API): template.pptx

Это «пуленепробиваемый» шаблон, созданный по специальной методологии (через «Образец слайдов»). Он определяет весь дизайн (фон, шрифты, статические элементы) и, что самое важное, предоставляет «слоты» (заполнители) с уникальными idx (индексами) для текста.

Данные (Рабочий заказ): slides_config.json

Это «контракт» для генератора. JSON-файл, который описывает каждый слайд: его заголовок, текст для заметок, пути к изображениям и, что ключевое, — layout_type (тип макета). Этот файл может генерироваться ИИ-агентом или писаться вручную.

Логика (Генератор): generate_presentation.py

Основной Python-скрипт, который выступает в роли «фабрики». Он читает «Рабочий заказ» (.json), загружает «Контракт API» (.pptx) и собирает финальный продукт.

Технологический стек

Python: Язык, на котором написана вся логика.

python-pptx: Ядро системы. Эта библиотека используется для открытия шаблона, добавления новых слайдов, доступа к заполнителям (placeholders) по их idx и, что самое важное, для добавления изображений (.add_picture()) с абсолютным позиционированием в Cm (сантиметрах).

Pillow (PIL): «Умный» компонент системы. Используется для предварительного анализа изображений до их вставки. Он считывает реальные пиксельные размеры скриншота, чтобы вычислить его пропорции.

markdown и beautifulsoup4: Вспомогательные утилиты, используемые модулем markdown_cleaner.py для очистки заметок докладчика от Markdown-разметки (например, маркеров списков), которая мешает в PowerPoint.

3. Ключевые возможности

3.1. Декларативная система макетов (Layout Contract)

Это ядро «интеллекта» системы. Вместо того чтобы пытаться динамически рассчитать, куда ставить картинки, система использует детерминированный, основанный на «чертежах» подход:

В generate_presentation.py жестко закодирована «библиотека чертежей» (набор констант в Cm) для каждого layout_type (например, single_wide, two_stack, two_tall_row).

JSON-файл (slides_config.json) просто выбирает, какой «чертеж» использовать, передавая layout_type.

Это делает систему невероятно предсказуемой и расширяемой. Добавление нового сложного макета — это просто измерение координат в PowerPoint и добавление нового блока elif layout_type == ... в Python-скрипт.

3.2. «Умное» масштабирование изображений (Smart Sizing)

Это вторая ключевая возможность, решающая проблему "вылезающих" или "слишком маленьких" скриншотов.

Для каждого «чертежа» макета определена не просто width (ширина) и height (высота), а MAX_WIDTH и MAX_HEIGHT. Это «ограничивающая рамка» (Bounding Box).

Функция get_smart_dimensions() (используя Pillow) сравнивает пропорции самой картинки с пропорциями «рамки».

Логика:

Если картинка шире «рамки», скрипт принудительно задает width=MAX_WIDTH, а height оставляет None (позволяя python-pptx сохранить пропорции).

Если картинка выше «рамки», скрипт принудительно задает height=MAX_HEIGHT, а width оставляет None.

Результат: Любой скриншот гарантированно вписывается в отведенную ему зону, сохраняя пропорции и максимально заполняя пространство.

3.3. Вспомогательные инструменты

В состав проекта также входят два утилитарных скрипта:

analyze_template.py (Анализатор шаблона):

Критически важный инструмент для первоначальной настройки. Он "допрашивает" template.pptx, находит нужный макет по имени (например, VideoLayout) и выводит список всех текстовых заполнителей и их уникальные idx (например, 10 и 11). Эти idx затем используются как "ключи" в основном скрипте.

markdown_cleaner.py (Очиститель заметок):

Решает проблему "грязного" копирования из Markdown. Он принимает текст, конвертирует его в HTML, а затем с помощью BeautifulSoup извлекает только чистый текст, удаляя все теги <ul>, <li> и прочее форматирование.

4. Возможные улучшения и будущая разработка

Хотя текущая система надежна благодаря своей детерминированности, ее можно развить:

Динамический «Bounding Box»: Вместо жестко заданных MAX_WIDTH и MAX_HEIGHT, функция get_smart_dimensions могла бы сама вычислять оптимальную рамку, исходя из доступного на слайде пространства (например, "вся область справа от Cm(10)").

ИИ-ассистент выбора макета: Вместо того, чтобы человек (или ИИ-агент) заранее решал, какой layout_type использовать, можно научить ИИ-агента анализировать пропорции переданных изображений и автоматически подбирать наиболее подходящий layout_type из нашей библиотеки.

Авто-центрирование: Расширить логику get_smart_dimensions, чтобы она возвращала не только width и height, но и рассчитанные left и top для автоматического центрирования картинки внутри ее «рамки».

Генератор slides_config.json: Создать скрипт-обертку, который принимает на вход простой .md файл (где макеты заданы в YAML front-matter) и автоматически генерирует из него сложный slides_config.json для "скармливания" основному генератору.
